import{c as E,g as D}from"./commonjsHelpers-5-cIlDoe.js";function F(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var $=F,G=typeof E=="object"&&E&&E.Object===Object&&E,q=G,X=q,Y=typeof self=="object"&&self&&self.Object===Object&&self,J=X||Y||Function("return this")(),M=J,K=M,Q=function(){return K.Date.now()},Z=Q,tt=/\s/;function et(t){for(var e=t.length;e--&&tt.test(t.charAt(e)););return e}var rt=et,it=rt,ot=/^\s+/;function st(t){return t&&t.slice(0,it(t)+1).replace(ot,"")}var nt=st,lt=M,ct=lt.Symbol,k=ct,j=k,P=Object.prototype,at=P.hasOwnProperty,ht=P.toString,O=j?j.toStringTag:void 0;function bt(t){var e=at.call(t,O),r=t[O];try{t[O]=void 0;var i=!0}catch{}var s=ht.call(t);return i&&(e?t[O]=r:delete t[O]),s}var ft=bt,dt=Object.prototype,ut=dt.toString;function mt(t){return ut.call(t)}var vt=mt,R=k,gt=ft,yt=vt,pt="[object Null]",Ot="[object Undefined]",C=R?R.toStringTag:void 0;function St(t){return t==null?t===void 0?Ot:pt:C&&C in Object(t)?gt(t):yt(t)}var Et=St;function Tt(t){return t!=null&&typeof t=="object"}var wt=Tt,It=Et,Bt=wt,zt="[object Symbol]";function $t(t){return typeof t=="symbol"||Bt(t)&&It(t)==zt}var xt=$t,Ht=nt,L=$,Vt=xt,_=NaN,jt=/^[-+]0x[0-9a-f]+$/i,Rt=/^0b[01]+$/i,Ct=/^0o[0-7]+$/i,Lt=parseInt;function _t(t){if(typeof t=="number")return t;if(Vt(t))return _;if(L(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=L(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=Ht(t);var r=Rt.test(t);return r||Ct.test(t)?Lt(t.slice(2),r?2:8):jt.test(t)?_:+t}var Wt=_t,Mt=$,I=Z,W=Wt,kt="Expected a function",Pt=Math.max,Ut=Math.min;function At(t,e,r){var i,s,c,a,l,n,o=0,d=!1,b=!1,m=!0;if(typeof t!="function")throw new TypeError(kt);e=W(e)||0,Mt(r)&&(d=!!r.leading,b="maxWait"in r,c=b?Pt(W(r.maxWait)||0,e):c,m="trailing"in r?!!r.trailing:m);function u(f){var v=i,p=s;return i=s=void 0,o=f,a=t.apply(p,v),a}function h(f){return o=f,l=setTimeout(S,e),d?u(f):a}function y(f){var v=f-n,p=f-o,V=e-v;return b?Ut(V,c-p):V}function x(f){var v=f-n,p=f-o;return n===void 0||v>=e||v<0||b&&p>=c}function S(){var f=I();if(x(f))return H(f);l=setTimeout(S,y(f))}function H(f){return l=void 0,m&&i?u(f):(i=s=void 0,a)}function A(){l!==void 0&&clearTimeout(l),o=0,i=n=s=l=void 0}function N(){return l===void 0?a:H(I())}function w(){var f=I(),v=x(f);if(i=arguments,s=this,n=f,v){if(l===void 0)return h(n);if(b)return clearTimeout(l),l=setTimeout(S,e),u(n)}return l===void 0&&(l=setTimeout(S,e)),a}return w.cancel=A,w.flush=N,w}var Nt=At,Dt=Nt,Ft=$,Gt="Expected a function";function qt(t,e,r){var i=!0,s=!0;if(typeof t!="function")throw new TypeError(Gt);return Ft(r)&&(i="leading"in r?!!r.leading:i,s="trailing"in r?!!r.trailing:s),Dt(t,e,{leading:i,maxWait:e,trailing:s})}var Xt=qt;const B=D(Xt),g=function(){return document.addEventListener?function(t,e,r,i=!1){t&&e&&r&&t.addEventListener(e,r,i)}:function(t,e,r){t&&e&&r&&t.attachEvent("on"+e,r)}}(),z=function(){return document.removeEventListener?function(t,e,r,i=!1){t&&e&&t.removeEventListener(e,r,i)}:function(t,e,r){t&&e&&t.detachEvent("on"+e,r)}}(),T=1e3/60;class U{constructor(e,r,i="hover",s,c,a){if(!e)throw new Error("need have table element");this.targetContaionEl=e,this.targetHorizontalEl=s,this.fullwidth=!1,this.mode=i,this.isVisible=!1,this.bottomIsVisibleObserverEl=r;const l=document.createElement("div");l.classList.add("scrollbar"),this.dom=l;const n=document.createElement("div");n.classList.add("scrollbar-content"),this.bar=n,l.appendChild(n),this.resetScroller(),this.bottomIsVisible=!1,this.updateTimer=null;const o=this;this.scrollEl="",this.checkIsScrollBottom=B(function(){if(!o.isVisible){o.hideScroller();return}o.bottomIsVisible?(o.hideScroller(),o.hideBar()):(o.showScroller(),o.mode==="always"&&o.showBar())},T),this.targetContainerScroll=B(function(d){const b=d.target,m=b.clientHeight,u=Math.ceil(b.scrollTop),h=b.scrollHeight;m+u>=h?(o.isVisible=!1,o.bottomIsVisible=!0,o.hideScroller(),o.hideBar()):o.bottomIsVisible&&(o.isVisible=!0,o.bottomIsVisible=!1,o.showScroller(),o.showBar())},T),g(e,"scroll",this.targetContainerScroll),this.targetHorizontalScroll=B(d=>{const b=d.target;if(d.stopPropagation(),this.scrollEl==="scrollBar")return!1;this.scrollEl="targetHorizontalEl";const m=b.clientWidth,u=b.scrollLeft,h=b.scrollWidth;(m+u>=h||u===0)&&o.resetScroller(),o.bottomIsVisible&&o.resetThumbPosition(),l.scrollTo(u,0),this.scrollEl=""},T),g(s,"scroll",this.targetHorizontalScroll),this.syncDestoryHandler=this.initScrollSyncHandler(),this.tableElObserver=null,MutationObserver&&(this.tableElObserver=new MutationObserver(()=>this.forceUpdate()),this.tableElObserver.observe(this.targetHorizontalEl,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["style"]})),this.tableResizeObserver=null,ResizeObserver&&(this.tableResizeObserver=new ResizeObserver(()=>this.forceUpdate()),this.tableResizeObserver.observe(s)),this.tableIntersectionObserver=null,this.bottomIsVisibleObserver=null,IntersectionObserver?(this.tableIntersectionObserver=new IntersectionObserver(([d])=>{o.isVisible=d.intersectionRatio>0,o.forceUpdate()}),this.tableIntersectionObserver.observe(s),this.bottomIsVisibleObserverEl&&(this.bottomIsVisibleObserver=new IntersectionObserver(([d])=>{o.bottomIsVisible=d.intersectionRatio>0,o.hideScroller(),o.hideBar()}),this.bottomIsVisibleObserver.observe(this.bottomIsVisibleObserverEl))):console.info("IntersectionObserver is not support，directive maybe problem"),this.rootRefs=c,this.horizontalEvents=a,this.initScrollBar(),window.onresize=this.resizeScrollBar}resizeScrollBar(){const e=this,r=window.screen.width,i=window.screen.height,s=window.innerWidth,c=window.innerHeight;s===r&&c===i?window.requestAnimationFrame(()=>{e.initScrollBar()}):e.initScrollBar&&e.initScrollBar()}initScrollBar(){let{dom:e,targetContaionEl:r}=this;e&&(e.style.visibility="hidden",e.style.position="fixed",e.style.bottom=this.getDistanceToBottom(r)+"px",e.style.zIndex=3,e.style.transition="all 0.3s ease"),this.forceUpdate&&this.forceUpdate()}resetThumbPosition(){const{targetHorizontalEl:e}=this;this.dom.scrollLeft=e.scrollLeft}getDistanceToBottom(e){let r=e.getBoundingClientRect(),i=window.pageYOffset||document.documentElement.scrollTop,s=document.documentElement.clientHeight,c=r.bottom+i,a=s-c;return a<0?0:a}resetScroller(){const{targetHorizontalEl:e,dom:r,bar:i}=this,s=e.getBoundingClientRect();this.bottomIsVisible||(r.style.width=s.width+"px",r.style.maxWidth=`${s.width}px`,r.style.left=`${s.left}px`,i&&(i.style.width=`${e.scrollWidth}px`))}forceUpdate(){clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>{this.resetScroller(),this.resetThumbPosition(),this.checkIsScrollBottom()},T)}initScrollSyncHandler(){const e=this,{targetHorizontalEl:r,dom:i}=this,s=c=>{if(e.bottomIsVisible||(c.stopPropagation(),this.scrollEl==="targetHorizontalEl"))return!1;this.scrollEl="scrollBar",e.isVisible=!0,e.bottomIsVisible=!1;const a=c.target,l=a.clientWidth,n=a.scrollLeft,o=a.scrollWidth,{scrollMethod:d,scrollLeftMethod:b,scrollRightMethod:m}=e.horizontalEvents;if(e.rootRefs[d](n),r.scrollTo(n,0),this.scrollEl="",l+n>=o){e.rootRefs[m]();return}if(n===0){e.rootRefs[b]();return}};return g(i,"scroll",s),function(){z(i,"scroll",s),z(this.targetContaionEl,"scroll",this.targetContainerScroll),z(this.targetHorizontalEl,"scroll",this.targetHorizontalScroll)}}showScroller(){const{targetHorizontalEl:e,targetContaionEl:r}=this,i=e.getBoundingClientRect();!this.fullwidth&&i.height>r.clientHeight&&(this.dom.style.visibility="visible")}hideScroller(){this.dom.style.visibility="hidden"}showBar(){this.isVisible&&(this.bar.style.opacity=1)}hideBar(){if(!this.isVisible){this.bar.style.opacity=0;return}this.mode==="always"?this.bar.style.opacity=1:this.bar.style.opacity=0}destory(){this.tableElObserver&&this.tableElObserver.disconnect(),this.tableResizeObserver&&this.tableResizeObserver.disconnect(),this.tableIntersectionObserver&&this.tableIntersectionObserver.disconnect(),this.bottomIsVisibleObserver&&this.bottomIsVisibleObserver.disconnect(),this.bottomIsVisibleObserverEl&&this.bottomIsVisibleObserverEl.parentElement&&this.bottomIsVisibleObserverEl.parentElement.removeChild(this.bottomIsVisibleObserverEl),clearTimeout(this.updateTimer),this.syncDestoryHandler()}}const Yt={inserted(t,e,r){const i=e.expression?e.value:e.arg,s=i.mode,c=i.containerBox?t.querySelector(`.${i.containerBox}`):t;if(!c){console.info("未找到可挂载的对象");return}if(!MutationObserver||!ResizeObserver||!IntersectionObserver)return;let a=i.horizontalBox,l=`.${a}`;Array.isArray(a)&&(l=a.map(y=>`.${y}`).join(" "));const n=c.querySelector(l);if(!n){console.info("未找到可挂载的对象");return}let o=i.events;const d=r.context.$refs[i.ref],b=n.scrollHeight,m=c.clientHeight;if(t.showBar=!0,b<=m)return t.showBar=!1,!1;const u=document.createElement("div"),h=new U(c,u,s,n,d,o);n.appendChild(u),n.appendChild(h.dom),t.horizontalScroll=h,s==="hover"?(g(n,"mouseover",h.showBar.bind(h)),g(n,"mouseleave",h.showBar.bind(h))):h.showBar()},unbind(t){t.showBar&&t.horizontalScroll&&t.horizontalScroll.destory()}},Jt={mounted(t,e,r){const i=e.expression?e.value:e.arg,s=i.mode,c=i.containerBox?t.querySelector(`.${i.containerBox}`):t;if(!c){console.info("未找到可挂载的对象");return}if(!MutationObserver||!ResizeObserver||!IntersectionObserver)return;let a=i.horizontalBox,l=`.${a}`;Array.isArray(a)&&(l=a.map(y=>`.${y}`).join(" "));const n=c.querySelector(l);if(!n){console.info("未找到可挂载的对象");return}const o=n.scrollHeight,d=c.clientHeight;if(t.showBar=!0,o<=d)return t.showBar=!1,!1;const b=document.createElement("div");n.appendChild(b);let m=i.events;const u=r.context.$refs[i.ref],h=new U(c,b,s,n,u,m);n.appendChild(h.dom),t.horizontalScroll=h,s==="hover"?(g(n,"mouseover",h.showBar.bind(h)),g(n,"mouseleave",h.showBar.bind(h))):h.showBar()},unmounted(t){t.showBar&&t.horizontalScroll&&t.horizontalScroll.destory()}},Kt={install(t){t.directive("horizontalScroll",{...Yt,...Jt})}},Zt=Kt;export{Zt as default};
