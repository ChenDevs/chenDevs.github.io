const n=JSON.parse(`{"key":"v-6430d112","path":"/%E5%BC%80%E5%8F%91%E6%97%A5%E5%BF%97/%E5%8E%8B%E7%BC%A9%E5%9B%BE%E7%89%87.html","title":"压缩图片","lang":"zh-CN","frontmatter":{"title":"压缩图片","tag":["项目总结"],"date":"2018-08-08T00:00:00.000Z","category":["开发日志"],"description":"//压缩图片 onChange = (files, type, index) =&gt; { if (type === 'add') { let imageList = [] files.map((item, index) =&gt; { return lrz(item.url, { quality: 0.7 }).then(rst =&gt; { // 处理成功会执行 imageList.push(rst.base64) this.setState({ imagesrc: imageList }) }) }) } else { this.setState({ imagesrc: [] }) } this.setState({ files }) } ;(function () { var coverImage = document.querySelector('&lt;div id=\\"coverImage\\"&gt;file&lt;/div&gt;') //图片压缩 coverImage.onchange = function () { lrz(this.files[0], { width: 640 }, function (results) { // 你需要的数据都在这里，可以以字符串的形式传送base64给服务端转存为图片。 var base64 = results.base64 function base64UrlToBlob(base64) { var bytes = window.atob(base64.split(',')[1]) //去掉url的头，并转换为byte //处理异常,将ascii码小于0的转换为大于0 var ab = new ArrayBuffer(bytes.length) var ia = new Uint8Array(ab) for (var i = 0; i &lt; bytes.length; i++) { ia[i] = bytes.charCodeAt(i) } return new Blob([ab], { type: 'image/jpg' }) //return Blob对象 } var formData = new FormData($('#toPic')[1]) var blob = base64UrlToBlob(base64) console.log(blob) formData.append('coverImage', blob) $.ajax({ url: 'xxx', type: 'POST', data: formData, dataType: 'json', contentType: false, processData: false, success: function (json) { console.log(json) } }) setTimeout(function () { demo_report('预压的图片', base64, base64.length * 0.5) }, 100) }) } })()","head":[["meta",{"property":"og:url","content":"http://magicbegin.gitee.io/vuepress-blog/%E5%BC%80%E5%8F%91%E6%97%A5%E5%BF%97/%E5%8E%8B%E7%BC%A9%E5%9B%BE%E7%89%87.html"}],["meta",{"property":"og:site_name","content":"Mr Chen's Blog"}],["meta",{"property":"og:title","content":"压缩图片"}],["meta",{"property":"og:description","content":"//压缩图片 onChange = (files, type, index) =&gt; { if (type === 'add') { let imageList = [] files.map((item, index) =&gt; { return lrz(item.url, { quality: 0.7 }).then(rst =&gt; { // 处理成功会执行 imageList.push(rst.base64) this.setState({ imagesrc: imageList }) }) }) } else { this.setState({ imagesrc: [] }) } this.setState({ files }) } ;(function () { var coverImage = document.querySelector('&lt;div id=\\"coverImage\\"&gt;file&lt;/div&gt;') //图片压缩 coverImage.onchange = function () { lrz(this.files[0], { width: 640 }, function (results) { // 你需要的数据都在这里，可以以字符串的形式传送base64给服务端转存为图片。 var base64 = results.base64 function base64UrlToBlob(base64) { var bytes = window.atob(base64.split(',')[1]) //去掉url的头，并转换为byte //处理异常,将ascii码小于0的转换为大于0 var ab = new ArrayBuffer(bytes.length) var ia = new Uint8Array(ab) for (var i = 0; i &lt; bytes.length; i++) { ia[i] = bytes.charCodeAt(i) } return new Blob([ab], { type: 'image/jpg' }) //return Blob对象 } var formData = new FormData($('#toPic')[1]) var blob = base64UrlToBlob(base64) console.log(blob) formData.append('coverImage', blob) $.ajax({ url: 'xxx', type: 'POST', data: formData, dataType: 'json', contentType: false, processData: false, success: function (json) { console.log(json) } }) setTimeout(function () { demo_report('预压的图片', base64, base64.length * 0.5) }, 100) }) } })()"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2023-10-27T11:35:00.000Z"}],["meta",{"property":"article:author","content":"Mr Chen"}],["meta",{"property":"article:tag","content":"项目总结"}],["meta",{"property":"article:published_time","content":"2018-08-08T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2023-10-27T11:35:00.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"压缩图片\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2018-08-08T00:00:00.000Z\\",\\"dateModified\\":\\"2023-10-27T11:35:00.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Mr Chen\\",\\"url\\":\\"https://gitee.com/magicBegin/vuepress-blog\\",\\"email\\":\\"599422271@qq.com\\"}]}"]]},"headers":[{"level":3,"title":"url 转 base64 base64 转 blob","slug":"url-转-base64-base64-转-blob","link":"#url-转-base64-base64-转-blob","children":[]},{"level":2,"title":"vue 图片压缩","slug":"vue-图片压缩","link":"#vue-图片压缩","children":[]}],"git":{"createdTime":1698406500000,"updatedTime":1698406500000,"contributors":[{"name":"chenzhen","email":"599422271@qq.com","commits":1}]},"readingTime":{"minutes":2.65,"words":795},"filePathRelative":"开发日志/压缩图片.md","localizedDate":"2018年8月8日","excerpt":"<div class=\\"language-javascript line-numbers-mode\\" data-ext=\\"js\\"><pre class=\\"language-javascript\\"><code><span class=\\"token comment\\">//压缩图片</span>\\n<span class=\\"token function-variable function\\">onChange</span> <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">files<span class=\\"token punctuation\\">,</span> type<span class=\\"token punctuation\\">,</span> index</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=&gt;</span> <span class=\\"token punctuation\\">{</span>\\n  <span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span>type <span class=\\"token operator\\">===</span> <span class=\\"token string\\">'add'</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>\\n    <span class=\\"token keyword\\">let</span> imageList <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">[</span><span class=\\"token punctuation\\">]</span>\\n    files<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">map</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">item<span class=\\"token punctuation\\">,</span> index</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=&gt;</span> <span class=\\"token punctuation\\">{</span>\\n      <span class=\\"token keyword\\">return</span> <span class=\\"token function\\">lrz</span><span class=\\"token punctuation\\">(</span>item<span class=\\"token punctuation\\">.</span>url<span class=\\"token punctuation\\">,</span> <span class=\\"token punctuation\\">{</span>\\n        <span class=\\"token literal-property property\\">quality</span><span class=\\"token operator\\">:</span> <span class=\\"token number\\">0.7</span>\\n      <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">.</span><span class=\\"token function\\">then</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">rst</span> <span class=\\"token operator\\">=&gt;</span> <span class=\\"token punctuation\\">{</span>\\n        <span class=\\"token comment\\">// 处理成功会执行</span>\\n        imageList<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">push</span><span class=\\"token punctuation\\">(</span>rst<span class=\\"token punctuation\\">.</span>base64<span class=\\"token punctuation\\">)</span>\\n        <span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span><span class=\\"token function\\">setState</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">{</span> <span class=\\"token literal-property property\\">imagesrc</span><span class=\\"token operator\\">:</span> imageList <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span>\\n      <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span>\\n    <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span>\\n  <span class=\\"token punctuation\\">}</span> <span class=\\"token keyword\\">else</span> <span class=\\"token punctuation\\">{</span>\\n    <span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span><span class=\\"token function\\">setState</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">{</span> <span class=\\"token literal-property property\\">imagesrc</span><span class=\\"token operator\\">:</span> <span class=\\"token punctuation\\">[</span><span class=\\"token punctuation\\">]</span> <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span>\\n  <span class=\\"token punctuation\\">}</span>\\n\\n  <span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span><span class=\\"token function\\">setState</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">{</span> files <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span>\\n<span class=\\"token punctuation\\">}</span>\\n<span class=\\"token punctuation\\">;</span><span class=\\"token punctuation\\">(</span><span class=\\"token keyword\\">function</span> <span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>\\n  <span class=\\"token keyword\\">var</span> coverImage <span class=\\"token operator\\">=</span> document<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">querySelector</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'&lt;div id=\\"coverImage\\"&gt;file&lt;/div&gt;'</span><span class=\\"token punctuation\\">)</span>\\n  <span class=\\"token comment\\">//图片压缩</span>\\n  coverImage<span class=\\"token punctuation\\">.</span><span class=\\"token function-variable function\\">onchange</span> <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">function</span> <span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>\\n    <span class=\\"token function\\">lrz</span><span class=\\"token punctuation\\">(</span><span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span>files<span class=\\"token punctuation\\">[</span><span class=\\"token number\\">0</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">,</span> <span class=\\"token punctuation\\">{</span> <span class=\\"token literal-property property\\">width</span><span class=\\"token operator\\">:</span> <span class=\\"token number\\">640</span> <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span> <span class=\\"token keyword\\">function</span> <span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">results</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>\\n      <span class=\\"token comment\\">// 你需要的数据都在这里，可以以字符串的形式传送base64给服务端转存为图片。</span>\\n      <span class=\\"token keyword\\">var</span> base64 <span class=\\"token operator\\">=</span> results<span class=\\"token punctuation\\">.</span>base64\\n      <span class=\\"token keyword\\">function</span> <span class=\\"token function\\">base64UrlToBlob</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">base64</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>\\n        <span class=\\"token keyword\\">var</span> bytes <span class=\\"token operator\\">=</span> window<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">atob</span><span class=\\"token punctuation\\">(</span>base64<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">split</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">','</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">[</span><span class=\\"token number\\">1</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">)</span> <span class=\\"token comment\\">//去掉url的头，并转换为byte</span>\\n        <span class=\\"token comment\\">//处理异常,将ascii码小于0的转换为大于0</span>\\n        <span class=\\"token keyword\\">var</span> ab <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">new</span> <span class=\\"token class-name\\">ArrayBuffer</span><span class=\\"token punctuation\\">(</span>bytes<span class=\\"token punctuation\\">.</span>length<span class=\\"token punctuation\\">)</span>\\n        <span class=\\"token keyword\\">var</span> ia <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">new</span> <span class=\\"token class-name\\">Uint8Array</span><span class=\\"token punctuation\\">(</span>ab<span class=\\"token punctuation\\">)</span>\\n        <span class=\\"token keyword\\">for</span> <span class=\\"token punctuation\\">(</span><span class=\\"token keyword\\">var</span> i <span class=\\"token operator\\">=</span> <span class=\\"token number\\">0</span><span class=\\"token punctuation\\">;</span> i <span class=\\"token operator\\">&lt;</span> bytes<span class=\\"token punctuation\\">.</span>length<span class=\\"token punctuation\\">;</span> i<span class=\\"token operator\\">++</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>\\n          ia<span class=\\"token punctuation\\">[</span>i<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> bytes<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">charCodeAt</span><span class=\\"token punctuation\\">(</span>i<span class=\\"token punctuation\\">)</span>\\n        <span class=\\"token punctuation\\">}</span>\\n        <span class=\\"token keyword\\">return</span> <span class=\\"token keyword\\">new</span> <span class=\\"token class-name\\">Blob</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">[</span>ab<span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">,</span> <span class=\\"token punctuation\\">{</span> <span class=\\"token literal-property property\\">type</span><span class=\\"token operator\\">:</span> <span class=\\"token string\\">'image/jpg'</span> <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span> <span class=\\"token comment\\">//return Blob对象</span>\\n      <span class=\\"token punctuation\\">}</span>\\n      <span class=\\"token keyword\\">var</span> formData <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">new</span> <span class=\\"token class-name\\">FormData</span><span class=\\"token punctuation\\">(</span><span class=\\"token function\\">$</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'#toPic'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">[</span><span class=\\"token number\\">1</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">)</span>\\n      <span class=\\"token keyword\\">var</span> blob <span class=\\"token operator\\">=</span> <span class=\\"token function\\">base64UrlToBlob</span><span class=\\"token punctuation\\">(</span>base64<span class=\\"token punctuation\\">)</span>\\n      console<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">log</span><span class=\\"token punctuation\\">(</span>blob<span class=\\"token punctuation\\">)</span>\\n      formData<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">append</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'coverImage'</span><span class=\\"token punctuation\\">,</span> blob<span class=\\"token punctuation\\">)</span>\\n      $<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">ajax</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">{</span>\\n        <span class=\\"token literal-property property\\">url</span><span class=\\"token operator\\">:</span> <span class=\\"token string\\">'xxx'</span><span class=\\"token punctuation\\">,</span>\\n        <span class=\\"token literal-property property\\">type</span><span class=\\"token operator\\">:</span> <span class=\\"token string\\">'POST'</span><span class=\\"token punctuation\\">,</span>\\n        <span class=\\"token literal-property property\\">data</span><span class=\\"token operator\\">:</span> formData<span class=\\"token punctuation\\">,</span>\\n        <span class=\\"token literal-property property\\">dataType</span><span class=\\"token operator\\">:</span> <span class=\\"token string\\">'json'</span><span class=\\"token punctuation\\">,</span>\\n        <span class=\\"token literal-property property\\">contentType</span><span class=\\"token operator\\">:</span> <span class=\\"token boolean\\">false</span><span class=\\"token punctuation\\">,</span>\\n        <span class=\\"token literal-property property\\">processData</span><span class=\\"token operator\\">:</span> <span class=\\"token boolean\\">false</span><span class=\\"token punctuation\\">,</span>\\n        <span class=\\"token function-variable function\\">success</span><span class=\\"token operator\\">:</span> <span class=\\"token keyword\\">function</span> <span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">json</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>\\n          console<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">log</span><span class=\\"token punctuation\\">(</span>json<span class=\\"token punctuation\\">)</span>\\n        <span class=\\"token punctuation\\">}</span>\\n      <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span>\\n      <span class=\\"token function\\">setTimeout</span><span class=\\"token punctuation\\">(</span><span class=\\"token keyword\\">function</span> <span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>\\n        <span class=\\"token function\\">demo_report</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'预压的图片'</span><span class=\\"token punctuation\\">,</span> base64<span class=\\"token punctuation\\">,</span> base64<span class=\\"token punctuation\\">.</span>length <span class=\\"token operator\\">*</span> <span class=\\"token number\\">0.5</span><span class=\\"token punctuation\\">)</span>\\n      <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span> <span class=\\"token number\\">100</span><span class=\\"token punctuation\\">)</span>\\n    <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span>\\n  <span class=\\"token punctuation\\">}</span>\\n<span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span>\\n</code></pre><div class=\\"line-numbers\\" aria-hidden=\\"true\\"><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div></div></div>","autoDesc":true}`);export{n as data};
